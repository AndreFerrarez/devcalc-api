name: Teste de Permiss√µes para Criar Issue

on:
  workflow_dispatch:

# Concede permiss√£o para o GITHUB_TOKEN criar e modificar issues
permissions:
  issues: write

jobs:
  create-issue-on-failure:
    runs-on: ubuntu-latest
    steps:
      - name:
          1. Simula uma falha (ex: configura√ß√£o ausente)
        id: check
        run: |
          # Este passo simula uma verifica√ß√£o. Vamos for√ßar uma "falha".
          echo "Verificando configura√ß√µes... Falha detectada!"
          echo "create_issue=true" >> $GITHUB_OUTPUT

      - name: 2. Cria uma issue usando o GITHUB_TOKEN
        # Este passo s√≥ executa se o passo anterior ('check') emitir a sa√≠da 'create_issue=true'
        if: steps.check.outputs.create_issue == 'true'
        uses: actions-ecosystem/action-create-issue@v1
        with:
          # Passa o token com a permiss√£o que concedemos acima
          github_token: ${{ secrets.GITHUB_TOKEN }}
          title: "üö® Falha no Pipeline: Verifica√ß√£o Autom√°tica"
          body: |
            O workflow **${{ github.workflow }}** detectou uma falha.
            
            - **Acionado por:** ${{ github.actor }}
            - **Commit:** ${{ github.sha }}
            
            √â necess√°rio verificar os logs da execu√ß√£o.